<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Q3: How ARC Works - iOS Interview Mastery: 100 Questions to Win</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Master iOS interviews with 100 essential questions, quizzes, and hands-on coding challenges">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">iOS Interview Mastery: 100 Questions to Win</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/durellwilson/ios-interview-mastery" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/durellwilson/ios-interview-mastery/edit/main/src/swift/03-arc-basics.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="q3-how-arc-works"><a class="header" href="#q3-how-arc-works">Q3: How ARC Works</a></h1>
<h2 id="-the-answer"><a class="header" href="#-the-answer">üéØ The Answer</a></h2>
<p><strong>ARC (Automatic Reference Counting)</strong> automatically manages memory by tracking how many strong references point to each class instance. When the count reaches zero, the instance is deallocated.</p>
<h2 id="-deep-dive"><a class="header" href="#-deep-dive">üìñ Deep Dive</a></h2>
<h3 id="the-three-rules-of-arc"><a class="header" href="#the-three-rules-of-arc">The Three Rules of ARC</a></h3>
<ol>
<li><strong>Strong reference created</strong> ‚Üí Reference count +1</li>
<li><strong>Strong reference removed</strong> ‚Üí Reference count -1</li>
<li><strong>Count reaches 0</strong> ‚Üí Instance deallocated</li>
</ol>
<h3 id="code-example"><a class="header" href="#code-example">Code Example</a></h3>
<pre><code class="language-swift">class Person {
    let name: String
    
    init(name: String) {
        self.name = name
        print("\(name) is initialized")
    }
    
    deinit {
        print("\(name) is deallocated")
    }
}

// Reference count: 0
var person1: Person? = Person(name: "Alice")  // RC: 1
var person2 = person1                          // RC: 2
var person3 = person1                          // RC: 3

person1 = nil  // RC: 2
person2 = nil  // RC: 1
person3 = nil  // RC: 0 ‚Üí deinit called!
</code></pre>
<h3 id="output"><a class="header" href="#output">Output:</a></h3>
<pre><code>Alice is initialized
Alice is deallocated
</code></pre>
<h2 id="-how-it-works-under-the-hood"><a class="header" href="#-how-it-works-under-the-hood">üîç How It Works Under the Hood</a></h2>
<pre><code class="language-swift">class Node {
    var value: Int
    var next: Node?
    
    init(value: Int) {
        self.value = value
    }
    
    deinit {
        print("Node \(value) deallocated")
    }
}

var head: Node? = Node(value: 1)  // RC: 1
head?.next = Node(value: 2)        // RC: 1 for node 2
head?.next?.next = Node(value: 3)  // RC: 1 for node 3

head = nil  // All nodes deallocated in order
</code></pre>
<h2 id="-common-pitfalls"><a class="header" href="#-common-pitfalls">‚ö†Ô∏è Common Pitfalls</a></h2>
<h3 id="pitfall-1-retain-cycles"><a class="header" href="#pitfall-1-retain-cycles">Pitfall 1: Retain Cycles</a></h3>
<pre><code class="language-swift">class Parent {
    var child: Child?
    deinit { print("Parent deallocated") }
}

class Child {
    var parent: Parent?  // ‚ö†Ô∏è Strong reference!
    deinit { print("Child deallocated") }
}

var parent: Parent? = Parent()
var child: Child? = Child()
parent?.child = child
child?.parent = parent

parent = nil
child = nil
// ‚ùå Nothing deallocated! Retain cycle!
</code></pre>
<h3 id="pitfall-2-closures-capturing-self"><a class="header" href="#pitfall-2-closures-capturing-self">Pitfall 2: Closures Capturing Self</a></h3>
<pre><code class="language-swift">class ViewController {
    var name = "VC"
    
    func setupHandler() {
        someAsyncCall {
            print(self.name)  // ‚ö†Ô∏è Strong capture!
        }
    }
    
    deinit { print("VC deallocated") }
}
</code></pre>
<h2 id="-arc-vs-garbage-collection"><a class="header" href="#-arc-vs-garbage-collection">üí° ARC vs Garbage Collection</a></h2>
<div class="table-wrapper"><table><thead><tr><th>ARC</th><th>Garbage Collection</th></tr></thead><tbody>
<tr><td>Compile-time</td><td>Runtime</td></tr>
<tr><td>Deterministic</td><td>Non-deterministic</td></tr>
<tr><td>No pause</td><td>Can pause app</td></tr>
<tr><td>Manual cycle breaking</td><td>Automatic</td></tr>
<tr><td>iOS/Swift</td><td>Java/C#</td></tr>
</tbody></table>
</div>
<h2 id="-interview-tips"><a class="header" href="#-interview-tips">üé§ Interview Tips</a></h2>
<p><strong>Interviewer</strong>: "How does ARC differ from manual memory management?"</p>
<p><strong>You</strong>: "ARC automatically inserts retain and release calls at compile time, so we don't have to manually manage memory like in C. But we still need to understand ownership to avoid retain cycles."</p>
<p><strong>Follow-up</strong>: "When does ARC not work?"</p>
<p><strong>You</strong>: "ARC only works with reference types (classes). Value types like structs don't need it. Also, ARC can't automatically break retain cycles - we need weak or unowned references for that."</p>
<h2 id="-practice-challenge"><a class="header" href="#-practice-challenge">üèãÔ∏è Practice Challenge</a></h2>
<p>Create a <code>Task</code> and <code>TaskManager</code> system where:</p>
<ol>
<li>TaskManager holds an array of tasks</li>
<li>Each Task has a completion handler</li>
<li>Prove that tasks are properly deallocated</li>
<li>Show what happens with a retain cycle</li>
</ol>
<details>
<summary>Solution</summary>
<pre><code class="language-swift">class Task {
    let id: Int
    var onComplete: (() -&gt; Void)?
    
    init(id: Int) {
        self.id = id
        print("Task \(id) created")
    }
    
    func execute() {
        print("Task \(id) executing")
        onComplete?()
    }
    
    deinit {
        print("Task \(id) deallocated")
    }
}

class TaskManager {
    var tasks: [Task] = []
    
    func addTask(_ task: Task) {
        tasks.append(task)
        
        // ‚úÖ Correct: weak self
        task.onComplete = { [weak self] in
            self?.removeTask(task)
        }
        
        // ‚ùå Wrong: creates retain cycle
        // task.onComplete = {
        //     self.removeTask(task)
        // }
    }
    
    func removeTask(_ task: Task) {
        tasks.removeAll { $0 === task }
        print("Task removed from manager")
    }
    
    deinit {
        print("TaskManager deallocated")
    }
}

// Test
var manager: TaskManager? = TaskManager()
let task = Task(id: 1)
manager?.addTask(task)
task.execute()
manager = nil  // Should deallocate everything
</code></pre>
</details>
<h2 id="-mastery-checklist"><a class="header" href="#-mastery-checklist">‚úÖ Mastery Checklist</a></h2>
<ul>
<li><input disabled="" type="checkbox"/>
Understand reference counting</li>
<li><input disabled="" type="checkbox"/>
Know when objects are deallocated</li>
<li><input disabled="" type="checkbox"/>
Can identify retain cycles</li>
<li><input disabled="" type="checkbox"/>
Understand ARC vs GC differences</li>
<li><input disabled="" type="checkbox"/>
Know ARC limitations</li>
</ul>
<hr />
<p><strong>Next</strong>: <a href="./04-reference-types.html">Q4: Strong, Weak, Unowned ‚Üí</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../swift/02-value-vs-reference.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../swift/04-reference-types.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../swift/02-value-vs-reference.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../swift/04-reference-types.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
